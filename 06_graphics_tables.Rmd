---
title: "graphics_tables"
author: "Leandro Pereira Garcia"
date: "October 10, 2019"
output: 
  word_document: 
    reference_docx: TESEv.06.docx
    fig_caption: yes
    fig_height: 8
    fig_width: 12
    toc: no
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
options(scipen=999)
set.seed(233)
```


```{r include=FALSE}
#Libraries
library(readr)
library(tidyverse)
library(ggplot2)
library(sf)
library(spData)
library(ggpubr)
library(RColorBrewer)
library(corrplot)
library(ggcorrplot)
library(reshape2)
```


```{r include=FALSE}
#Databases
base_efi <- read_csv("bases/efficiency_analysis.csv")
```



```{r include=FALSE}
#Importing the world map
WorldData <- map_data('world')
WorldData %>% filter(region != "Antarctica") -> WorldData
WorldData <- fortify(WorldData)


base_efi$region_map <- base_efi$LOCATION
base_efi[which(base_efi$LOCATION == "Congo, Rep."), 58] <- "Republic of Congo"
base_efi[which(base_efi$LOCATION == "Egypt, Arab Rep."), 58] <- "Egypt"
base_efi[which(base_efi$LOCATION == "Korea, Rep."), 58] <- "South Korea"
base_efi[which(base_efi$LOCATION == "North Macedonia"), 58] <- "Macedonia"
base_efi[which(base_efi$LOCATION == "Russian Federation"), 58] <- "Russia"
base_efi[which(base_efi$LOCATION == "Trinidad and Tobago"), 58] <- "Trinidad"
base_efi[which(base_efi$LOCATION == "United Kingdom"), 58] <- "UK"
base_efi[which(base_efi$LOCATION == "United States"), 58] <- "USA"
base_efi[which(base_efi$LOCATION == "Brunei Darussalam"), 58] <- "Brunei"
base_efi[which(base_efi$LOCATION == "Congo, Dem. Rep."), 58] <- "Democratic Republic of the Congo"
base_efi[which(base_efi$LOCATION == "Gambia, The"), 58] <- "Gambia"
base_efi[which(base_efi$LOCATION == "Cote d'Ivoire"), 58] <- "Ivory Coast"
base_efi[which(base_efi$LOCATION == "Iran, Islamic Rep."), 58] <- "Iran"
base_efi[which(base_efi$LOCATION == "Kyrgyz Republic"), 58] <- "Kyrgyzstan"
base_efi[which(base_efi$LOCATION == "Lao PDR"), 58] <- "Laos"
base_efi[which(base_efi$LOCATION == "Slovak Republic"), 58] <- "Slovakia"
base_efi[which(base_efi$LOCATION == "Yemen, Rep."), 58] <- "Yemen"


base_map <- base_efi
base_map <- merge(base_map, WorldData, by.x = "region_map", by.y = "region", all.x = T)

```
Ao todo, foram utilizadas informações de 143 países, sendo 70 pobres e 73 não pobres. Os indicadores destes países antes e após a imputação estão exibidos nos Anexo 1 e 2.
Entre os países pobres, todos apresentaram redução na taxa de mortalidade neonatal e na taxa de mortalidade de crianças com idade de 28dias a 5 anos, entre 2016 e 2017. O país pobre com a maior redução na taxa de mortalidade neonatal  foi `r base_efi[which(base_efi$MEAN_RATE_NEO == min(base_efi$MEAN_RATE_NEO)),1]`, com uma variação de `r round(base_efi[which(base_efi$MEAN_RATE_NEO == min(base_efi$MEAN_RATE_NEO)),9],3)`. O país com a menor redução foi `r base_efi[which(base_efi$MEAN_RATE_NEO == max(base_efi$MEAN_RATE_NEO)),1]`, apresentando uma redução de `r round(base_efi[which(base_efi$MEAN_RATE_NEO == max(base_efi$MEAN_RATE_NEO)),9],3)`. Com relação à taxa de mortalidade de crianças com idade entre 28 dias e 5 anos, o pais com a maior redução foi `r base_efi[which(base_efi$MEAN_RATE_NEO_U5 == min(base_efi$MEAN_RATE_NEO_U5)),1]` e com o com a menor `r base_efi[which(base_efi$MEAN_RATE_NEO_U5 == max(base_efi$MEAN_RATE_NEO_U5)),1]`, com variações de `r round(base_efi[which(base_efi$MEAN_RATE_NEO_U5 == min(base_efi$MEAN_RATE_NEO_U5)),11],3)` e `r round(base_efi[which(base_efi$MEAN_RATE_NEO_U5 == max(base_efi$MEAN_RATE_NEO_U5)),11],3)`, respectivamente.
Com relação à variação da entre os gastos públicos (tratamento), todos os países pobres apresentaram aumento entre 2013 e 2014. O país com a maior variação foi `r base_efi[which(base_efi$PUBLIC_EXP_LAGGED2 == max(base_efi$PUBLIC_EXP_LAGGED2)),1]`, US\$`r round(base_efi[which(base_efi$PUBLIC_EXP_LAGGED2 == max(base_efi$PUBLIC_EXP_LAGGED2)),16],2)`; o com amenor foi `r base_efi[which(base_efi$PUBLIC_EXP_LAGGED2 == min(base_efi$PUBLIC_EXP_LAGGED2)),1]`: US\$`r round(base_efi[which(base_efi$PUBLIC_EXP_LAGGED2 == min(base_efi$PUBLIC_EXP_LAGGED2)),16],2)`. A proporção dos gastos públicos destinados à saúde foi maior em  `r base_efi[which(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2 == max(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2)),1]`, `r round(base_efi[which(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2 == max(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2)),17],2)`; e  menor em  `r base_efi[which(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2 == min(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2)),1]`, `r round(base_efi[which(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2 == min(base_efi$PROP_PUBLIC_HEALTH_EXP_LAGGED2)),17],2)`. (Figura 1)

```{r fig.width=18, fig.height=18}
#Neontal, 28d<U5, Tax, Public Expenditure distribution
myPalette_rev <- colorRampPalette(brewer.pal(11, "Spectral")) #Increasing
myPalette <- colorRampPalette(rev(brewer.pal(11, "Spectral")))  #Decreasing

base_mapa_neo <- dplyr::select(base_map, c(region_map, MEAN_RATE_NEO))
plot1 <- ggplot()+
        geom_map(data=WorldData, map=WorldData,
                  aes(x=long, y=lat, group=group, map_id=region),
                  fill="white", colour="#7f7f7f", size=0.5)+
        geom_map(data=base_mapa_neo, map=WorldData,
                  aes(fill= MEAN_RATE_NEO, map_id=region_map),
                  colour="#7f7f7f", size=0.5)+
        coord_map("rectangular", lat0=0, xlim=c(-190,190), ylim=c(-60, 90))+
        labs(fill="Mean neo 2016-2017", x="", y="")+
        theme_bw()+
        theme(panel.border = element_blank())+
        scale_fill_gradientn(colours = myPalette(20), 
                             labels = round(quantile(base_mapa_neo$MEAN_RATE_NEO, c(.01,.99)),3), 
                             breaks = round(quantile(base_mapa_neo$MEAN_RATE_NEO, c(.01,.99)),3))

base_mapa_neo_u5 <- dplyr::select(base_map, c(region_map, MEAN_RATE_NEO_U5))
plot2 <- ggplot()+
        geom_map(data=WorldData, map=WorldData,
                  aes(x=long, y=lat, group=group, map_id=region),
                  fill="white", colour="#7f7f7f", size=0.5)+
        geom_map(data=base_mapa_neo_u5, map=WorldData,
                  aes(fill= MEAN_RATE_NEO_U5, map_id=region_map),
                  colour="#7f7f7f", size=0.5)+
        coord_map("rectangular", lat0=0, xlim=c(-190,190), ylim=c(-60, 90))+
        labs(fill="Mean 28d<5y 2016-2017", x="", y="")+
        theme_bw()+
        theme(panel.border = element_blank())+
        scale_fill_gradientn(colours = myPalette(20), 
                             labels = round(quantile(base_mapa_neo_u5$MEAN_RATE_NEO_U5, c(.01,.99)),3), 
                             breaks = round(quantile(base_mapa_neo_u5$MEAN_RATE_NEO_U5, c(.01,.99)),3))

base_mapa_public <- dplyr::select(base_map, c(region_map, PUBLIC_EXP_LAGGED2))
plot3 <- ggplot()+
        geom_map(data=WorldData, map=WorldData,
                  aes(x=long, y=lat, group=group, map_id=region),
                  fill="white", colour="#7f7f7f", size=0.5)+
        geom_map(data=base_mapa_public, map=WorldData,
                  aes(fill= PUBLIC_EXP_LAGGED2, map_id=region_map),
                  colour="#7f7f7f", size=0.5)+
        coord_map("rectangular", lat0=0, xlim=c(-190,190), ylim=c(-60, 90))+
        labs(fill="Mean pub exp 2013-2014", x="", y="")+
        theme_bw()+
        theme(panel.border = element_blank())+
        scale_fill_gradientn(colours = myPalette_rev(20), 
                             labels = round(quantile(base_mapa_public$PUBLIC_EXP_LAGGED2, c(.01,.99)),0), 
                             breaks = round(quantile(base_mapa_public$PUBLIC_EXP_LAGGED2, c(.01,.99)),0))

base_mapa_prop <- dplyr::select(base_map, c(region_map, PROP_PUBLIC_HEALTH_EXP_LAGGED2))
plot4 <- ggplot()+
        geom_map(data=WorldData, map=WorldData,
                  aes(x=long, y=lat, group=group, map_id=region),
                  fill="white", colour="#7f7f7f", size=0.5)+
        geom_map(data=base_mapa_prop, map=WorldData,
                  aes(fill= PROP_PUBLIC_HEALTH_EXP_LAGGED2, map_id=region_map),
                  colour="#7f7f7f", size=0.5)+
        coord_map("rectangular", lat0=0, xlim=c(-190,190), ylim=c(-60, 90))+
        labs(fill="Mean prop exp health 2013-2014", x="", y="")+
        theme_bw()+
        theme(panel.border = element_blank())+
        scale_fill_gradientn(colours = myPalette_rev(20), 
                             labels = round(quantile(base_mapa_prop$PROP_PUBLIC_HEALTH_EXP_LAGGED2, c(.01,.99)),2), 
                             breaks = round(quantile(base_mapa_prop$PROP_PUBLIC_HEALTH_EXP_LAGGED2, c(.01,.99)),2))


base_poor <- subset(base_efi, base_efi$INCOME_CLASS %in% c("L", "LM"))
base_poor$TAX_PPP_LAGGED2 <- NULL
base_poor$SURFACE <- NULL

names(base_poor) <- c("LOCATION",                       "INCOME_CLASS",                "Mean neo - poor",   
                     "Mean 28d<5y - poor",              "Fertility",                   "Plus 65y",    
                     "GDP per cap",                     "Public exp",                  "Prop publ health exp",          
                     "Out of pocket",                   "Gini",                        "Poverty",
                     "Inflation",                       "Unemployment general",        "Sanitation",
                     "Water",                           "Unemployment fem",            "School life exp fem",  
                     "Women parliament",                "School life exp gen",         "Out of school",
                     "Corruption control",              "Gov effectiveness",           "Political stab",
                     "Regulatory quality",              "Rule of law",                 "Undernourishment",
                     "Doctors",                         "Delivery assistance",         "AIDS prevalence",
                     "Malaria incidence",               "DPT",                         "Hospital beds",
                     "Electricity",                     "Urban rate",                  "Population",
                     "Pop density",                     "Longitude",                   "Latitude",
                     "PRED_NEO",                        "IC_05_NEO",                  "IC_95_NEO", 
                     "PRED_NEO_U5",                     "IC_05_NEO_U5",                "IC_95_NEO_U5", 
                     "IMPACT_NEO",                      "IMPACT_NEO_U5",               "HEALTH",     
                     "NON_HEALTH",                      "EFI",                         "TARG_HEALTH", 
                     "TARG_NON_HEALTH",                 "TARG_PROP",                   "region_map")

base_non_poor <- subset(base_efi, (base_efi$INCOME_CLASS %in% c("H", "UM")))
base_non_poor$TAX_PPP_LAGGED2 <- NULL
base_non_poor$SURFACE <- NULL

names(base_non_poor) <- c("LOCATION",                   "INCOME_CLASS",                "Mean neo - non poor",   
                     "Mean 28d<5y - non poor",         "Fertility",                   "Plus 65y",    
                     "GDP per cap",                     "Public exp",                  "Prop publ health exp",          
                     "Out of pocket",                   "Gini",                        "Poverty",
                     "Inflation",                       "Unemployment general",        "Sanitation",
                     "Water",                           "Unemployment fem",            "School life exp fem",  
                     "Women parliament",                "School life exp gen",         "Out of school",
                     "Corruption control",              "Gov effectiveness",           "Political stab",
                     "Regulatory quality",              "Rule of law",                 "Undernourishment",
                     "Doctors",                         "Delivery assistance",         "AIDS prevalence",
                     "Malaria incidence",               "DPT",                         "Hospital beds",
                     "Electricity",                     "Urban rate",                  "Population",
                     "Pop density",                     "Longitude",                   "Latitude",
                     "PRED_NEO",                        "IC_05_NEO",                  "IC_95_NEO", 
                     "PRED_NEO_U5",                     "IC_05_NEO_U5",                "IC_95_NEO_U5", 
                     "IMPACT_NEO",                      "IMPACT_NEO_U5",               "HEALTH",     
                     "NON_HEALTH",                      "EFI",                         "TARG_HEALTH", 
                     "TARG_NON_HEALTH",                 "TARG_PROP",                   "region_map")


cor_poor <- cor(base_poor[,c(3:39)], method = "kendall")[,c(1,2)]
cor_non_poor <- cor(base_non_poor[,c(3:39)], method = "kendall")[,c(1,2)] 
cor_diff <- cbind(cor_poor, cor_non_poor)
cor_diff <- cor_diff[-c(1,2),]
cor_diff <- cor_diff[c(1,8,7,9,17,23,26,27,32,10,2,3,4,5,6,11,12,13,14,15,16,18,19,20,21,22,24,25,28,29,30,31,33,34,35),c(1,3,2,4)]

res_poor <- cor.mtest(base_poor[,c(3:39)], conf.level = .95, method = "kendall")[[1]][,c(1,2)]
res_non_poor <- cor.mtest(base_non_poor[,c(3:39)], conf.level = .95, method = "kendall")[[1]][,c(1,2)]
res_diff <- cbind(res_poor, res_non_poor)
res_diff <- res_diff[-c(1,2),]
res_diff <- res_diff[c(1,8,7,9,17,23,26,27,32,10,2,3,4,5,6,11,12,13,14,15,16,18,19,20,21,22,24,25,28,29,30,31,33,34,35), c(1,3,2,4)] 

plot5 <- ggcorrplot(cor_diff, outline.col = "white", p.mat = res_diff, lab = TRUE,
           colors = c("#5E4FA2", "white","#9E0142"),lab_size = 3.5,  insig = "blank", show.legend = F)
   


plot6 <- ggarrange(plot1, plot2, plot3,plot4, labels = c("A", "B", "C", "D"),
           common.legend = F,legend = "bottom")

ggarrange(plot6, plot5, labels = c("A", "E"), nrow = 2)

```





```{r fig.width=12, fig.height=16}
base_efi[which(base_efi$INCOME_CLASS == "L"), 2] <- "Low"
base_efi[which(base_efi$INCOME_CLASS == "LM"), 2] <- "Low-Median"
base_efi[which(base_efi$INCOME_CLASS == "UM"), 2] <- "Upper-Median"
base_efi[which(base_efi$INCOME_CLASS == "H"), 2] <- "High"
base_efi$INCOME_CLASS <- factor(base_efi$INCOME_CLASS, levels = c("Low", "Low-Median", "Upper-Median", "High"))
base_efi_poor <- subset(base_efi, base_efi$INCOME_CLASS %in% c("Low", "Low-Median"))
base_efi_poor$pol_ic05neo <- NA
for(i in seq_along(base_efi_poor$IC_05_NEO)){
      base_efi_poor$pol_ic05neo[i] <- ifelse(base_efi_poor$IC_05_NEO[i] > 0, "pos", "neg")
}
base_efi_poor$pol_ic95neo <- NA
for(i in seq_along(base_efi_poor$IC_95_NEO)){
      base_efi_poor$pol_ic95neo[i] <- ifelse(base_efi_poor$IC_95_NEO[i] > 0, "pos", "neg")
}
base_efi_poor$sig_neo <- NA
for(i in seq_along(base_efi_poor$IC_95_NEO)){
      base_efi_poor$sig_neo[i] <- ifelse(base_efi_poor$pol_ic05neo[i] == base_efi_poor$pol_ic95neo[i], "yes", "no")
}

base_efi_poor$pol_ic05neo_u5 <- NA
for(i in seq_along(base_efi_poor$IC_05_NEO_U5)){
      base_efi_poor$pol_ic05neo_u5[i] <- ifelse(base_efi_poor$IC_05_NEO_U5[i] > 0, "pos", "neg")
}
base_efi_poor$pol_ic95neo_u5 <- NA
for(i in seq_along(base_efi_poor$IC_95_NEO_U5)){
      base_efi_poor$pol_ic95neo_u5[i] <- ifelse(base_efi_poor$IC_95_NEO_U5[i] > 0, "pos", "neg")
}
base_efi_poor$sig_neo_u5 <- NA
for(i in seq_along(base_efi_poor$IC_95_NEO_U5)){
      base_efi_poor$sig_neo_u5[i] <- ifelse(base_efi_poor$pol_ic05neo_u5[i] == base_efi_poor$pol_ic95neo_u5[i], "yes", "no")
}


plot1 <- ggplot(base_efi_poor)+
   geom_point(aes(PRED_NEO,reorder(LOCATION, PRED_NEO), colour = sig_neo))+
   geom_segment(aes(x = IC_05_NEO, xend = IC_95_NEO, y = LOCATION, yend = LOCATION, colour = sig_neo))+
   geom_vline(xintercept = 0, linetype = "dashed", colour = "black")+
   labs(x = "Treatment neo", y = "")+
   theme_bw()+
   scale_y_discrete(position = "left")+
   scale_colour_manual(values = myPalette_rev(2), aesthetics = "colour", "Significant")
plot2 <- ggplot(base_efi_poor)+
   geom_point(aes(PRED_NEO_U5,reorder(LOCATION, PRED_NEO_U5),, color = sig_neo_u5))+
   geom_segment(aes(x = IC_05_NEO_U5, xend = IC_95_NEO_U5, y = LOCATION, yend = LOCATION, color = sig_neo_u5))+
   geom_vline(xintercept = 0, linetype = "dashed", colour = "black")+
   labs(x = "Treatment 28d>5y", y = "")+
   theme_bw()+
   scale_y_discrete(position = "right")+
   scale_colour_manual(values = myPalette_rev(2), aesthetics = "colour")
ggarrange(plot1, plot2, ncol = 2, labels = c("A", "B"),legend = "bottom", common.legend = T)

```





```{r }
# Create a table of the effect of the treatment
base_efi_table <- base_efi_poor
base_efi_table$IC_NEO <- paste0("(CI95% ",round(base_efi_table$IC_05_NEO,7), " ", round(base_efi_table$IC_95_NEO,7),")")
base_efi_table$IC_NEO_U5 <- paste0("(CI95% ",round(base_efi_table$IC_05_NEO_U5,7), " ", round(base_efi_table$IC_95_NEO_U5,7),")")
base_efi_table$PRED_NEO <- round(base_efi_table$PRED_NEO,7)
base_efi_table$PRED_NEO_U5 <- round(base_efi_table$PRED_NEO_U5,7)
base_efi_table$PRED_NEO <- paste0(base_efi_table$PRED_NEO," ",base_efi_table$IC_NEO)
base_efi_table$PRED_NEO_U5 <- paste0(base_efi_table$PRED_NEO_U5," ",base_efi_table$IC_NEO_U5)
base_efi_table$MEAN_RATE_NEO <- round(base_efi_table$MEAN_RATE_NEO,3)
base_efi_table$MEAN_RATE_NEO_U5 <- round(base_efi_table$MEAN_RATE_NEO_U5,3)
base_efi_table$PUBLIC_EXP_LAGGED2 <- round(base_efi_table$PUBLIC_EXP_LAGGED2,2)
base_efi_table$PUBLIC_EXP_LAGGED2 <- paste0("US$",base_efi_table$PUBLIC_EXP_LAGGED2)
                                 

base_efi_table <- base_efi_table %>%
     dplyr::select("LOCATION", "MEAN_RATE_NEO", 
                   "MEAN_RATE_NEO_U5", "PUBLIC_EXP_LAGGED2", 
                   "PRED_NEO", "PRED_NEO_U5",
                   "IMPACT_NEO","TARG_IMPACT_NEO", 
                   "IMPACT_NEO_U5", "TARG_IMPACT_NEO_U5", 
                   "EFI","PROP_PUBLIC_HEALTH_EXP_LAGGED2",
                   "TARG_PROP")

names(base_efi_table) <- c("Country", "Mean Neo", 
                           "Mean 28d>5y", "Mean Public Exp", 
                           "Cost-Effect Neo", "Cost-Effect 28d>5y", 
                           "Impact Neo", "Targ Impact Neo", 
                           "Impact 28d>5y", "Targ Impact 28d>5y",
                           "Efficiency", "Prop Public Exp to Health", 
                           "Targ Prop Public Exp to Health")

knitr::kable(base_efi_table, digits = 7)

```


Ao se analisar a relação entre impacto e eficiência, alguns países destacam-se como o Senegal, que aprenseta um baixo desenvolvimento econômico, mas que está acima do percentil 80 tanto em relação à eficiência, quanto ao impacto do governos na mortalidade neonatal e na mortalida de crianças. A distribuição dos países pobres segundo o impacto e a eficiência de seus governos pode ser observado na Figura 2 e os dados na Tabela 2.
```{r fig.width=16, fig.height=8}

effect_effici <- subset(base_efi_poor, !is.na(base_efi_poor$EFI))

plot1 <- ggplot(effect_effici,aes(EFI, IMPACT_NEO))+
            geom_text(label = effect_effici$LOCATION,check_overlap = T, size =3)+
            geom_smooth(method = "lm" )+
            labs(y = "Impact neo", x = "Efficiency")+
            theme_bw()

plot2 <- ggplot(effect_effici,aes(EFI, IMPACT_NEO_U5))+
            geom_text(label = effect_effici$LOCATION,check_overlap = T, size =3)+
            geom_smooth(method = "lm" )+
            labs(y = "Impact neo", x = "Efficiency")+
            theme_bw()

ggarrange(plot1, plot2, ncol = 2, labels = c("A", "B"))
```




#Proportion of Public Health Spending and Efectiveness
##Impact Neo
```{r }

impneo <- subset(base_efi_poor, base_efi_poor$sig_neo == "yes")

impneo_prop_kend <- cor(as.matrix(dplyr::select(impneo, c(IMPACT_NEO, PROP_PUBLIC_HEALTH_EXP_LAGGED2))), method = "kendall" )
impneo_prop_sig <- cor.mtest(as.matrix(dplyr::select(impneo, c(IMPACT_NEO, PROP_PUBLIC_HEALTH_EXP_LAGGED2))), method = "kendall" )
impneo_prop_kend[1,2]
impneo_prop_sig$p[1,2]
```



##Impact 28d<5y
```{r }
impneo_u5 <- subset(base_efi_poor, base_efi_poor$sig_neo_u5 == "yes")

imp28d5y_prop_kend <- cor(as.matrix(dplyr::select(impneo_u5, c(IMPACT_NEO_U5, PROP_PUBLIC_HEALTH_EXP_LAGGED2))), method = "kendall" )
imp28d5y_prop_sig <- cor.mtest(as.matrix(dplyr::select(impneo_u5, c(IMPACT_NEO_U5, PROP_PUBLIC_HEALTH_EXP_LAGGED2))), method = "kendall",conf.level = .95)
imp28d5y_prop_kend[1,2]
imp28d5y_prop_sig$p[1,2]
```




##Efficiency
```{r }
efi_prop_kend <- cor(as.matrix(dplyr::select(effect_effici, c(EFI, PROP_PUBLIC_HEALTH_EXP_LAGGED2))), method = "kendall")
efi_prop_sig <- cor.mtest(as.matrix(dplyr::select(effect_effici, c(EFI, PROP_PUBLIC_HEALTH_EXP_LAGGED2))), method = "kendall" )
efi_prop_kend[1,2]
efi_prop_sig$p[1,2]
```




```{r fig.width=16, fig.height=8}
plot1 <- ggplot(impneo, aes(PROP_PUBLIC_HEALTH_EXP_LAGGED2,IMPACT_NEO))+
            geom_jitter(aes(color = LOCATION))+
            geom_smooth(method = "lm", bs="cr", se = T, color = "#5E4FA2")+
            labs(fill="", x="Prop health exp", y="Impact neo")+
            theme_bw()+ 
            theme(legend.position = "none") 
plot2 <- ggplot(impneo_u5, aes(PROP_PUBLIC_HEALTH_EXP_LAGGED2,IMPACT_NEO_U5))+
            geom_jitter(aes(color = LOCATION))+
            geom_smooth(method = "lm", se = T, color = "#5E4FA2")+
            labs(fill="", x="Prop health exp", y="Impact 28d>5y")+
            theme_bw()+ 
            theme(legend.position = "none")
plot3 <- ggplot(effect_effici, aes(PROP_PUBLIC_HEALTH_EXP_LAGGED2,EFI))+
            geom_jitter(aes(color = LOCATION))+
            geom_smooth(method = "lm", se = T, color = "#5E4FA2")+
            labs(fill="", x="Prop health exp", y="Efficiency neo")+
            theme_bw()+ 
            theme(legend.position = "none")


plot4 <- ggarrange(plot1, plot2, nrow = 1,ncol = 2,
          labels = c("A", "B"))

ggarrange(plot4, plot3,nrow = 2,ncol = 1,
          labels = c("A", "C"))


```


```{r fig.width=12, fig.height=8}

plot1 <- ggplot(effect_effici)+
   geom_point(aes(TARG_PROP,reorder(LOCATION, TARG_IMPACT_NEO_U5)), color = "#9E0142")+
   geom_segment(aes(x = PROP_PUBLIC_HEALTH_EXP_LAGGED2, xend = TARG_PROP, y = LOCATION, yend = LOCATION), color = "#9E0142")+
   labs(x = "Target prop health exp neo", y = "")+
   theme_bw()

plot2 <- ggplot(effect_effici)+
   geom_point(aes(TARG_IMPACT_NEO,reorder(LOCATION, TARG_IMPACT_NEO_U5)), color = "#5E4FA2")+
   geom_segment(aes(x = IMPACT_NEO, xend = TARG_IMPACT_NEO, y = LOCATION, yend = LOCATION), color = "#5E4FA2")+
   labs(x = "Target impact neo", y = "")+
   theme_bw()+
   theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
         axis.ticks.y=element_blank())

plot3 <- ggplot(effect_effici)+
   geom_point(aes(TARG_IMPACT_NEO_U5,reorder(LOCATION, TARG_IMPACT_NEO_U5)), color = "#5E4FA2")+
   geom_segment(aes(x = IMPACT_NEO_U5, xend = TARG_IMPACT_NEO_U5, y = LOCATION, yend = LOCATION), color = "#5E4FA2")+
   labs(x = "Target impact 28d>5y", y = "")+
   theme_bw()+
   scale_y_discrete(position = "right")

ggarrange(plot1, plot2, plot3, ncol = 3, widths = c(1.5, 1, 1.5))

```





